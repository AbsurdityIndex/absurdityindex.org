---
/**
 * Bill Timeline
 *
 * Displays the legislative progress of a bill using the shared ProgressTimeline component.
 * Shows horizontal layout on desktop, vertical on mobile.
 */
import LegislativePathPopover from './LegislativePathPopover.astro';
import ProgressTimeline from '../ui/ProgressTimeline.astro';
import { getBillProgress } from '../../utils/billProgress';

interface Props {
  status: string;
  dateIntroduced: Date;
  billNumber?: string;
}

const { status, dateIntroduced, billNumber = '' } = Astro.props;

// Get progress state from shared utility
const progress = getBillProgress(billNumber, status);
const { stages, currentStageIndex, outcome } = progress;

// Convert stages to timeline format
const timelineStages = stages.map(stage => ({
  id: stage.id,
  label: stage.label,
}));

// Format the introduction date
const formattedDate = dateIntroduced instanceof Date
  ? dateIntroduced.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
  : String(dateIntroduced);
---

<div class="bill-timeline mb-8">
  <div class="flex items-center justify-between mb-3">
    <span class="text-xs font-sans font-semibold uppercase tracking-wide text-navy-700 flex items-center gap-1.5">
      Legislative Progress
      <LegislativePathPopover billNumber={billNumber} status={status} />
    </span>
    <span class="text-xs font-sans text-navy-600">
      Introduced {formattedDate}
    </span>
  </div>

  {/* Desktop: horizontal timeline */}
  <div class="hidden md:block">
    <ProgressTimeline
      stages={timelineStages}
      currentIndex={currentStageIndex}
      outcome={outcome}
      variant="full"
      class="bill-timeline-desktop"
    />
  </div>

  {/* Mobile: vertical timeline */}
  <div class="md:hidden">
    <ProgressTimeline
      stages={timelineStages}
      currentIndex={currentStageIndex}
      outcome={outcome}
      variant="vertical"
      class="bill-timeline-mobile"
    />
  </div>
</div>

<style>
  /* Desktop timeline adjustments */
  .bill-timeline-desktop {
    --dot-size: 24px;
    --dot-size-current: 32px;
    --dot-size-final: 40px;
    --line-height: 4px;
    --gap: 12px;
    --font-size-label: 12px;
    --font-size-number: 11px;
  }

  /* Mobile timeline adjustments */
  .bill-timeline-mobile {
    --dot-size: 24px;
    --dot-size-current: 32px;
    --dot-size-final: 40px;
  }
</style>
