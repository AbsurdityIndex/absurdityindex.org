---
import Icon from '../ui/Icon.astro';

interface Amendment {
  number: string;
  sponsor?: string;
  description?: string;
  status?: string;
  chamber?: 'house' | 'senate';
  url?: string;
}

interface Props {
  amendments?: Amendment[];
  amendmentCount?: number;
  maxItems?: number;
}

const { amendments = [], amendmentCount, maxItems = 10 } = Astro.props;

const total = amendmentCount ?? amendments.length;

if (total === 0) {
  return null;
}

const displayAmendments = amendments.slice(0, maxItems);
const hasMore = amendments.length > maxItems;

function getStatusColor(status?: string) {
  if (!status) return 'bg-navy-100 text-navy-600';
  const s = status.toLowerCase();
  if (s.includes('agreed') || s.includes('adopted') || s.includes('passed')) return 'bg-green-100 text-green-700';
  if (s.includes('failed') || s.includes('rejected') || s.includes('withdrawn')) return 'bg-red-100 text-red-700';
  if (s.includes('pending') || s.includes('submitted')) return 'bg-yellow-100 text-yellow-700';
  return 'bg-navy-100 text-navy-600';
}
---

<div class="bg-cream-100 border border-gold-300 rounded-lg p-5">
  <h4 class="font-serif font-bold text-navy-900 text-sm mb-4 flex items-center gap-2">
    <Icon name="edit" size={16} class="text-gold-600" />
    Amendments
    <span class="ml-auto text-xs font-sans font-medium text-navy-500">
      {total} total
    </span>
  </h4>

  {displayAmendments.length > 0 ? (
    <div class="space-y-3">
      {displayAmendments.map((amend) => (
        <div class="flex gap-3 p-3 bg-white rounded border border-gold-200 hover:border-gold-300 transition-colors">
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-mono text-sm font-semibold text-navy-900">
                {amend.number}
              </span>
              {amend.chamber && (
                <span class={`text-xs px-1.5 py-0.5 rounded ${amend.chamber === 'house' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                  {amend.chamber === 'house' ? 'House' : 'Senate'}
                </span>
              )}
              {amend.status && (
                <span class={`text-xs px-1.5 py-0.5 rounded ${getStatusColor(amend.status)}`}>
                  {amend.status}
                </span>
              )}
            </div>
            {amend.sponsor && (
              <p class="text-xs text-navy-600 mb-1">
                <Icon name="user" size={10} class="inline -mt-0.5 mr-1" />
                {amend.sponsor}
              </p>
            )}
            {amend.description && (
              <p class="text-sm text-navy-700 line-clamp-2">
                {amend.description}
              </p>
            )}
          </div>
          {amend.url && (
            <a href={amend.url} target="_blank" rel="noopener noreferrer" class="text-gold-600 hover:text-gold-700 flex-shrink-0">
              <Icon name="external-link" size={14} />
            </a>
          )}
        </div>
      ))}
    </div>
  ) : (
    <p class="text-sm text-navy-500 italic">
      {total} amendments were considered, but detailed data is not available.
    </p>
  )}

  {hasMore && (
    <div class="mt-4 pt-4 border-t border-gold-200 text-center">
      <p class="text-xs text-navy-500">
        Showing {maxItems} of {amendments.length} amendments
      </p>
    </div>
  )}
</div>
