---
import Icon from '../ui/Icon.astro';

interface Props {
  billType: 'sensible' | 'absurd' | 'real';
  size?: 'sm' | 'md';
  showHelp?: boolean;
}

const { billType, size = 'sm', showHelp = false } = Astro.props;

const config = {
  sensible: {
    label: 'Not Bill',
    classes: 'bg-green-700/90 text-white border-green-800',
    icon: 'lightbulb' as const,
  },
  absurd: {
    label: 'Not Bill',
    classes: 'bg-green-700/90 text-white border-green-800',
    icon: 'lightbulb' as const,
  },
  real: {
    label: 'Real Bill',
    classes: 'bill-type-real bg-navy-700/90 text-white border-navy-800',
    icon: 'landmark' as const,
  },
};

const { label, classes, icon } = config[billType];
const sizeClasses = size === 'sm' ? 'text-xs px-2.5 py-0.5' : 'text-sm px-3 py-1';
const iconSize = size === 'sm' ? 12 : 14;
---

<span class="bill-type-badge-wrapper inline-flex items-center gap-1">
  <span class:list={[
    'inline-flex items-center gap-1.5 font-sans font-semibold rounded-full border',
    classes,
    sizeClasses
  ]}>
    <Icon name={icon} size={iconSize} strokeWidth={2.5} />
    {label}
  </span>
  {showHelp && (
    <button
      type="button"
      class="help-btn"
      aria-label="Learn about bill types"
      title="What does this mean?"
    >
      <Icon name="help-circle" size={14} />
    </button>
  )}
</span>

<style>
  :global(html.dark) .bill-type-real {
    background-color: rgba(26, 45, 77, 0.9);
    border-color: #121F36;
  }
  :global(html[data-theme="solarized-dark"]) .bill-type-real {
    background-color: rgba(10, 61, 73, 0.9);
    border-color: #073642;
  }

  .help-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.25rem;
    height: 1.25rem;
    background: transparent;
    border: none;
    color: var(--color-navy-400);
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .help-btn:hover {
    color: var(--color-navy-600);
    background: var(--color-cream-200);
  }

  :global(html.dark) .help-btn {
    color: var(--color-cream-400);
  }

  :global(html.dark) .help-btn:hover {
    color: var(--color-cream-200);
    background: rgba(255, 255, 255, 0.1);
  }
</style>

<script>
  // Open glossary drawer on help button click
  const helpBtns = document.querySelectorAll('.bill-type-badge-wrapper .help-btn');
  helpBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      document.dispatchEvent(new CustomEvent('open-legislative-glossary'));
    });
  });
</script>
