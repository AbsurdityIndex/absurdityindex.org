---
import BillStatus from './BillStatus.astro';
import AbsurdityMeter from './AbsurdityMeter.astro';
import Icon from '../ui/Icon.astro';

interface Props {
  sponsor: string;
  cosponsors?: string[];
  committee?: string;
  status: string;
  dateIntroduced: Date;
  dateUpdated?: Date;
  realSource?: string;
  realJurisdiction?: string;
  absurdityIndex?: number;
  congressDotGovUrl?: string;
  congressNumber?: number;
  excerpt?: string;
}

const {
  sponsor,
  cosponsors = [],
  committee,
  status,
  dateIntroduced,
  dateUpdated,
  realSource,
  realJurisdiction,
  absurdityIndex,
  congressDotGovUrl,
  congressNumber,
  excerpt,
} = Astro.props;

function formatDate(date: Date) {
  return new Date(date).toLocaleDateString('en-US', {
    month: 'long',
    day: 'numeric',
    year: 'numeric',
    timeZone: 'UTC',
  });
}

// Parse sponsor into name and party
const sponsorName = sponsor.replace(/\s*\([^)]+\)\s*$/, '').trim();
const sponsorParty = sponsor.match(/\(([^)]+)\)/)?.[1] || '';
---

<aside class="bg-cream-100 border border-gold-300 rounded-lg p-6 space-y-5">
  <h2 class="font-serif font-bold text-navy-900 flex items-center gap-2">
    <div class="w-6 h-6 rounded-full bg-gold-100 flex items-center justify-center">
      <Icon name="clipboard-list" size={14} class="text-gold-700" />
    </div>
    Bill Information
  </h2>

  <dl class="space-y-4 text-sm">
    {/* Sponsor */}
    <div class="flex items-start gap-3">
      <div
        class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5"
      >
        <Icon name="user" size={16} class="text-navy-600" />
      </div>
      <div>
        <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-0.5">
          Sponsor
        </dt>
        <dd class="font-serif text-navy-900">
          {sponsorName}
          {
            sponsorParty && (
              <span class="font-mono text-sm text-navy-500 ml-1">({sponsorParty})</span>
            )
          }
        </dd>
      </div>
    </div>

    {/* Cosponsors */}
    {
      cosponsors.length > 0 && (
        <div class="flex items-start gap-3">
          <div class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5">
            <Icon name="users" size={16} class="text-navy-600" />
          </div>
          <div>
            <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-0.5">
              Cosponsors
            </dt>
            <dd class="font-serif text-navy-900">{cosponsors.join(', ')}</dd>
          </div>
        </div>
      )
    }

    {/* Committee */}
    {
      committee && (
        <div class="flex items-start gap-3">
          <div class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5">
            <Icon name="building" size={16} class="text-navy-600" />
          </div>
          <div>
            <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-0.5">
              Committee
            </dt>
            <dd class="font-serif text-navy-900">{committee}</dd>
          </div>
        </div>
      )
    }

    {/* Status */}
    <div class="flex items-start gap-3">
      <div
        class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5"
      >
        <Icon name="check-circle" size={16} class="text-navy-600" />
      </div>
      <div>
        <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-1">
          Status
        </dt>
        <dd>
          <BillStatus status={status} />
        </dd>
      </div>
    </div>

    {/* Dates */}
    <div class="flex items-start gap-3">
      <div
        class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5"
      >
        <Icon name="calendar" size={16} class="text-navy-600" />
      </div>
      <div>
        <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-0.5">
          Date Introduced
        </dt>
        <dd class="font-serif text-navy-900">{formatDate(dateIntroduced)}</dd>
        {
          dateUpdated && (
            <dd class="font-serif text-navy-600 text-sm mt-1">
              Updated: {formatDate(dateUpdated)}
            </dd>
          )
        }
      </div>
    </div>

    {/* Jurisdiction */}
    {
      realJurisdiction && (
        <div class="flex items-start gap-3">
          <div class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5">
            <Icon name="landmark" size={16} class="text-navy-600" />
          </div>
          <div>
            <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-0.5">
              Real Jurisdiction
            </dt>
            <dd class="font-serif text-navy-900">{realJurisdiction}</dd>
          </div>
        </div>
      )
    }

    {/* Congress */}
    {
      congressNumber && (
        <div class="flex items-start gap-3">
          <div class="w-8 h-8 rounded-full bg-navy-100 flex items-center justify-center flex-shrink-0 mt-0.5">
            <Icon name="landmark" size={16} class="text-navy-600" />
          </div>
          <div>
            <dt class="font-sans font-medium text-navy-500 text-xs uppercase tracking-wide mb-0.5">
              Congress
            </dt>
            <dd class="font-serif text-navy-900">{congressNumber}th Congress</dd>
          </div>
        </div>
      )
    }
  </dl>

  {/* Absurdity Meter */}
  {
    absurdityIndex && (
      <div class="pt-4 border-t border-gold-300">
        <AbsurdityMeter score={absurdityIndex} />
      </div>
    )
  }

  {/* External Links */}
  {
    (realSource || congressDotGovUrl) && (
      <div class="pt-4 border-t border-gold-300 space-y-2">
        {realSource && (
          <a
            href={realSource}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-2 text-sm font-sans font-medium text-navy-600 hover:text-gold-700 transition-colors"
          >
            <Icon name="link" size={14} />
            Real Source
            <Icon name="external-link" size={12} class="ml-auto" />
          </a>
        )}
        {congressDotGovUrl && (
          <a
            href={congressDotGovUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-2 text-sm font-sans font-medium text-navy-600 hover:text-gold-700 transition-colors"
          >
            <Icon name="landmark" size={14} />
            View on Congress.gov
            <Icon name="external-link" size={12} class="ml-auto" />
          </a>
        )}
      </div>
    )
  }
</aside>
