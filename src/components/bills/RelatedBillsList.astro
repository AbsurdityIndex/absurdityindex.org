---
import Icon from '../ui/Icon.astro';

interface RelatedBill {
  billNumber: string;
  title?: string;
  relationship: string;
  congress?: number;
  url?: string;
}

interface Props {
  relatedBills?: RelatedBill[];
}

const { relatedBills = [] } = Astro.props;

if (!relatedBills || relatedBills.length === 0) {
  return null;
}

function getRelationshipColor(relationship: string) {
  const r = relationship.toLowerCase();
  if (r.includes('identical')) return 'bg-green-100 text-green-700 border-green-200';
  if (r.includes('companion')) return 'bg-blue-100 text-blue-700 border-blue-200';
  if (r.includes('replaced') || r.includes('superseded'))
    return 'bg-purple-100 text-purple-700 border-purple-200';
  return 'bg-navy-100 text-navy-600 border-navy-200';
}
---

<div class="bg-cream-100 border border-gold-300 rounded-lg p-5">
  <h4 class="font-serif font-bold text-navy-900 text-sm mb-4 flex items-center gap-2">
    <Icon name="link" size={16} class="text-gold-600" />
    Related Legislation
    <span class="ml-auto text-xs font-sans font-medium text-navy-500">
      {relatedBills.length} bills
    </span>
  </h4>

  <div class="space-y-2">
    {
      relatedBills.map((bill) => (
        <div class="flex items-start gap-3 p-3 bg-white rounded border border-gold-200 hover:border-gold-300 transition-colors">
          <Icon name="file-text" size={16} class="text-navy-400 flex-shrink-0 mt-0.5" />
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 flex-wrap mb-1">
              <span class="font-mono text-sm font-semibold text-navy-900">{bill.billNumber}</span>
              <span
                class={`text-xs px-1.5 py-0.5 rounded border ${getRelationshipColor(bill.relationship)}`}
              >
                {bill.relationship}
              </span>
              {bill.congress && (
                <span class="text-xs text-navy-500">{bill.congress}th Congress</span>
              )}
            </div>
            {bill.title && <p class="text-sm text-navy-700 line-clamp-2">{bill.title}</p>}
          </div>
          {bill.url && (
            <a
              href={bill.url}
              target="_blank"
              rel="noopener noreferrer"
              class="text-gold-600 hover:text-gold-700 flex-shrink-0"
            >
              <Icon name="external-link" size={14} />
            </a>
          )}
        </div>
      ))
    }
  </div>
</div>
