---
import Icon from '../ui/Icon.astro';

interface TextVersion {
  type: string;
  date?: Date;
  formats?: {
    pdf?: string;
    html?: string;
    xml?: string;
    txt?: string;
  };
}

interface Props {
  textVersions?: TextVersion[];
  congressDotGovUrl?: string;
}

const { textVersions = [], congressDotGovUrl } = Astro.props;

if (!textVersions || textVersions.length === 0) {
  return null;
}

// Sort by date descending (most recent first)
const sortedVersions = [...textVersions].sort((a, b) => {
  if (!a.date) return 1;
  if (!b.date) return -1;
  return new Date(b.date).getTime() - new Date(a.date).getTime();
});

function getVersionIcon(type: string) {
  const t = type.toLowerCase();
  if (t.includes('enrolled') || t.includes('law')) return 'check-circle';
  if (t.includes('engrossed')) return 'file-text';
  if (t.includes('reported')) return 'building';
  if (t.includes('introduced')) return 'file-plus';
  return 'file-text';
}

function getVersionColor(type: string) {
  const t = type.toLowerCase();
  if (t.includes('enrolled') || t.includes('law')) return 'bg-green-100 border-green-200';
  if (t.includes('engrossed')) return 'bg-blue-100 border-blue-200';
  return 'bg-white border-gold-200';
}
---

<div class="bg-cream-100 border border-gold-300 rounded-lg p-5">
  <h4 class="font-serif font-bold text-navy-900 text-sm mb-4 flex items-center gap-2">
    <Icon name="file-text" size={16} class="text-gold-600" />
    Text Versions
    <span class="ml-auto text-xs font-sans font-medium text-navy-500">
      {textVersions.length} versions
    </span>
  </h4>

  <div class="space-y-2">
    {sortedVersions.map((version, i) => (
      <div class={`flex items-center gap-3 p-3 rounded border ${getVersionColor(version.type)}`}>
        <Icon name={getVersionIcon(version.type)} size={16} class={`flex-shrink-0 ${i === 0 ? 'text-green-600' : 'text-navy-400'}`} />
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2">
            <span class="font-medium text-sm text-navy-900">
              {version.type}
            </span>
            {i === 0 && (
              <span class="text-xs px-1.5 py-0.5 rounded bg-green-100 text-green-700">
                Latest
              </span>
            )}
          </div>
          {version.date && (
            <time class="text-xs text-navy-500">
              {new Date(version.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', timeZone: 'UTC' })}
            </time>
          )}
        </div>
        {version.formats && (
          <div class="flex gap-1">
            {version.formats.pdf && (
              <a href={version.formats.pdf} target="_blank" rel="noopener noreferrer" class="text-xs px-2 py-1 rounded bg-red-50 text-red-700 hover:bg-red-100 transition-colors">
                PDF
              </a>
            )}
            {version.formats.html && (
              <a href={version.formats.html} target="_blank" rel="noopener noreferrer" class="text-xs px-2 py-1 rounded bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors">
                HTML
              </a>
            )}
            {version.formats.xml && (
              <a href={version.formats.xml} target="_blank" rel="noopener noreferrer" class="text-xs px-2 py-1 rounded bg-purple-50 text-purple-700 hover:bg-purple-100 transition-colors">
                XML
              </a>
            )}
            {version.formats.txt && (
              <a href={version.formats.txt} target="_blank" rel="noopener noreferrer" class="text-xs px-2 py-1 rounded bg-navy-50 text-navy-700 hover:bg-navy-100 transition-colors">
                TXT
              </a>
            )}
          </div>
        )}
      </div>
    ))}
  </div>

  {congressDotGovUrl && (
    <div class="mt-4 pt-4 border-t border-gold-200">
      <a href={`${congressDotGovUrl}/text`} target="_blank" rel="noopener noreferrer" class="text-sm text-gold-700 hover:text-gold-800 flex items-center gap-1">
        <Icon name="external-link" size={12} />
        View all text versions on Congress.gov
      </a>
    </div>
  )}
</div>
