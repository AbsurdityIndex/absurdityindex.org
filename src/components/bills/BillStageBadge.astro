---
/**
 * BillStageBadge - Compact status indicator for bill cards
 *
 * Shows a small colored badge indicating the bill's legislative stage:
 * - Introduced (gray) - Just submitted
 * - In Committee (blue) - Under review
 * - Passed House/Senate (gold) - Cleared one chamber
 * - Passed Both (gold) - Cleared both chambers
 * - Signed (green) - Became law
 * - Vetoed (red) - Rejected by president
 * - Dead (dark gray) - Failed or expired
 */
import Icon from '../ui/Icon.astro';

interface Props {
  status: string;
  size?: 'xs' | 'sm';
}

const { status, size = 'sm' } = Astro.props;

const s = status.toLowerCase();

// Determine stage and styling
type StageConfig = {
  label: string;
  icon: string;
  bg: string;
  text: string;
  dot: string;
};

function getStageConfig(): StageConfig {
  // Final outcomes first (most specific)
  if (s.includes('became public law') || s.includes('became law') || s.includes('enacted')) {
    return {
      label: 'Law',
      icon: 'award',
      bg: 'bg-green-100',
      text: 'text-green-800',
      dot: 'bg-green-500',
    };
  }
  if (s.includes('signed')) {
    return {
      label: 'Signed',
      icon: 'pen-tool',
      bg: 'bg-green-100',
      text: 'text-green-800',
      dot: 'bg-green-500',
    };
  }
  if (s.includes('vetoed')) {
    return {
      label: 'Vetoed',
      icon: 'x-circle',
      bg: 'bg-red-100',
      text: 'text-red-800',
      dot: 'bg-red-500',
    };
  }
  if (s.includes('adopted') || s.includes('agreed to')) {
    return {
      label: 'Adopted',
      icon: 'check-circle',
      bg: 'bg-green-100',
      text: 'text-green-800',
      dot: 'bg-green-500',
    };
  }

  // Failed/dead states
  if (
    s.includes('failed') ||
    s.includes('rejected') ||
    s.includes('died') ||
    s.includes('pocket')
  ) {
    return {
      label: 'Dead',
      icon: 'x-circle',
      bg: 'bg-gray-200',
      text: 'text-gray-700',
      dot: 'bg-gray-500',
    };
  }

  // In progress states
  if (s.includes('enrolled') || s.includes('presented to president')) {
    return {
      label: 'Enrolled',
      icon: 'send',
      bg: 'bg-gold-100',
      text: 'text-gold-800',
      dot: 'bg-gold-500',
    };
  }
  if (
    (s.includes('passed') && s.includes('house') && s.includes('senate')) ||
    s.includes('passed both')
  ) {
    return {
      label: 'Passed Both',
      icon: 'check-circle',
      bg: 'bg-gold-100',
      text: 'text-gold-800',
      dot: 'bg-gold-500',
    };
  }
  if (s.includes('passed house') || (s.includes('house') && s.includes('passed'))) {
    return {
      label: 'Passed House',
      icon: 'vote',
      bg: 'bg-gold-100',
      text: 'text-gold-800',
      dot: 'bg-gold-500',
    };
  }
  if (s.includes('passed senate') || (s.includes('senate') && s.includes('passed'))) {
    return {
      label: 'Passed Senate',
      icon: 'vote',
      bg: 'bg-gold-100',
      text: 'text-gold-800',
      dot: 'bg-gold-500',
    };
  }
  if (s.includes('reported')) {
    return {
      label: 'Reported',
      icon: 'check-square',
      bg: 'bg-blue-100',
      text: 'text-blue-800',
      dot: 'bg-blue-500',
    };
  }
  if (s.includes('committee') || s.includes('referred')) {
    return {
      label: 'In Committee',
      icon: 'users',
      bg: 'bg-blue-100',
      text: 'text-blue-700',
      dot: 'bg-blue-400',
    };
  }
  if (s.includes('introduced')) {
    return {
      label: 'Introduced',
      icon: 'file-text',
      bg: 'bg-gray-100',
      text: 'text-gray-700',
      dot: 'bg-gray-400',
    };
  }

  // Default - pending/unknown
  return {
    label: 'Pending',
    icon: 'clock',
    bg: 'bg-gray-100',
    text: 'text-gray-600',
    dot: 'bg-gray-400',
  };
}

const config = getStageConfig();
const isXs = size === 'xs';
---

<span
  class:list={[
    'inline-flex items-center gap-1 font-sans font-medium rounded-full',
    config.bg,
    config.text,
    isXs ? 'text-[10px] px-1.5 py-0.5' : 'text-xs px-2 py-0.5',
  ]}
  title={status}
>
  <span class:list={['rounded-full flex-shrink-0', config.dot, isXs ? 'w-1.5 h-1.5' : 'w-2 h-2']}
  ></span>
  {config.label}
</span>
