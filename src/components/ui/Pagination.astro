---
interface Props {
  currentPage: number;
  totalPages: number;
  basePath: string;
  pagePathPrefix?: string;
  maxNeighborPages?: number;
}

const {
  currentPage,
  totalPages,
  basePath,
  pagePathPrefix = `${basePath}/page`,
  maxNeighborPages = 1,
} = Astro.props;

function pageUrl(page: number) {
  if (page <= 1) return basePath;
  return `${pagePathPrefix}/${page}`;
}

function buildPageSequence() {
  const pageNumbers = new Set<number>([1, totalPages]);

  for (
    let page = currentPage - maxNeighborPages;
    page <= currentPage + maxNeighborPages;
    page += 1
  ) {
    if (page >= 1 && page <= totalPages) {
      pageNumbers.add(page);
    }
  }

  const sortedPages = Array.from(pageNumbers).sort((a, b) => a - b);
  const sequence: Array<number | 'ellipsis'> = [];

  sortedPages.forEach((page, index) => {
    if (index > 0) {
      const prev = sortedPages[index - 1];
      if (page - prev > 1) {
        sequence.push('ellipsis');
      }
    }
    sequence.push(page);
  });

  return sequence;
}

const pageSequence = buildPageSequence();
const hasPrev = currentPage > 1;
const hasNext = currentPage < totalPages;
---

{
  totalPages > 1 && (
    <nav
      class="flex flex-wrap items-center justify-center gap-1 sm:gap-1.5"
      aria-label="Pagination"
    >
      <a
        href={hasPrev ? pageUrl(currentPage - 1) : undefined}
        class:list={[
          'inline-flex items-center rounded-md border px-2.5 py-1.5 text-[13px] font-sans transition-colors min-[375px]:px-3 min-[375px]:py-2 min-[375px]:text-sm',
          hasPrev
            ? 'border-gold-300 bg-white text-navy-700 hover:border-gold-500 hover:bg-cream-100'
            : 'border-cream-300 bg-cream-100 text-navy-300 pointer-events-none',
        ]}
        aria-disabled={!hasPrev}
      >
        Previous
      </a>

      {pageSequence.map((page) =>
        page === 'ellipsis' ? (
          <span
            class="inline-flex min-w-8 items-center justify-center px-1 text-[13px] text-navy-400 min-[375px]:min-w-9 min-[375px]:text-sm"
            aria-hidden="true"
          >
            ...
          </span>
        ) : (
          <a
            href={pageUrl(page)}
            class:list={[
              'inline-flex min-w-8 items-center justify-center rounded-md border px-2.5 py-1.5 text-[13px] font-sans transition-colors min-[375px]:min-w-9 min-[375px]:px-3 min-[375px]:py-2 min-[375px]:text-sm',
              page === currentPage
                ? 'border-navy-800 bg-navy-800 font-semibold text-white'
                : 'border-gold-300 bg-white text-navy-700 hover:border-gold-500 hover:bg-cream-100',
            ]}
            aria-current={page === currentPage ? 'page' : undefined}
          >
            {page}
          </a>
        ),
      )}

      <a
        href={hasNext ? pageUrl(currentPage + 1) : undefined}
        class:list={[
          'inline-flex items-center rounded-md border px-2.5 py-1.5 text-[13px] font-sans transition-colors min-[375px]:px-3 min-[375px]:py-2 min-[375px]:text-sm',
          hasNext
            ? 'border-gold-300 bg-white text-navy-700 hover:border-gold-500 hover:bg-cream-100'
            : 'border-cream-300 bg-cream-100 text-navy-300 pointer-events-none',
        ]}
        aria-disabled={!hasNext}
      >
        Next
      </a>
    </nav>
  )
}
