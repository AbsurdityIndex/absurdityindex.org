---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroBanner from '../components/ui/HeroBanner.astro';
import BillOfTheDay from '../components/ui/BillOfTheDay.astro';
import BillCard from '../components/bills/BillCard.astro';
import Divider from '../components/ui/Divider.astro';
import DidYouKnow from '../components/ui/DidYouKnow.astro';
import RunningTicker from '../components/satirical/RunningTicker.astro';
import QuorumCounter from '../components/satirical/QuorumCounter.astro';
import NewsletterForm from '../components/ui/NewsletterForm.astro';
import { getCollection } from 'astro:content';

const allBills = await getCollection('bills');

// Real bills — sorted by absurdity
const realBills = allBills
  .filter((b) => b.data.billType === 'real')
  .sort((a, b) => (b.data.absurdityIndex ?? 0) - (a.data.absurdityIndex ?? 0))
  .slice(0, 3);

// Not bills — featured first, then recent
const notBills = allBills
  .filter((b) => b.data.billType !== 'real');
const featuredNotBills = notBills
  .filter((b) => b.data.featured)
  .sort((a, b) => b.data.dateIntroduced.getTime() - a.data.dateIntroduced.getTime())
  .slice(0, 3);
const recentNotBills = notBills
  .sort((a, b) => b.data.dateIntroduced.getTime() - a.data.dateIntroduced.getTime())
  .slice(0, 3);

// Use featured if available, otherwise recent
const showcaseNotBills = featuredNotBills.length > 0 ? featuredNotBills : recentNotBills;
---

<BaseLayout title="Real Bills. Real Absurdity. Satirical Common Sense." description="Where the bills make sense and the laws don't. Real federal bills scored on an Absurdity Index, paired with satirical legislation that actually makes sense.">
  <RunningTicker />
  <HeroBanner />
  <BillOfTheDay />

  {realBills.length > 0 && (
    <section class="mx-auto max-w-6xl px-3 py-8 min-[375px]:px-4 min-[430px]:py-10 md:py-12">
      <div class="mb-2 flex items-start justify-between gap-3 min-[430px]:items-center">
        <h2 class="font-serif text-xl font-bold text-navy-900 min-[375px]:text-2xl md:text-3xl">Most Absurd Real Bills</h2>
        <QuorumCounter />
      </div>
      <p class="mb-6 font-serif text-sm italic text-navy-600 min-[375px]:text-base">Real legislation from Congress, ranked by absurdity</p>
      <div class="gold-rule"></div>
      <div class="mt-6 grid grid-cols-1 gap-4 min-[430px]:mt-8 min-[430px]:gap-5 min-[520px]:grid-cols-2 lg:grid-cols-3">
        {realBills.map((bill) => (
          <BillCard bill={bill} />
        ))}
      </div>
      <div class="mt-8 text-center min-[430px]:mt-10">
        <a
          href="/bills"
          class="inline-block rounded bg-navy-800 px-6 py-2.5 font-serif text-base text-gold-300 transition-colors hover:bg-navy-700 min-[430px]:px-8 min-[430px]:py-3 min-[430px]:text-lg"
        >
          View All Real Bills &rarr;
        </a>
      </div>
    </section>
  )}

  {realBills.length === 0 && (
    <section class="mx-auto max-w-6xl px-3 py-8 min-[375px]:px-4 min-[430px]:py-10 md:py-12">
      <div class="mb-2 flex items-start justify-between gap-3 min-[430px]:items-center">
        <h2 class="font-serif text-xl font-bold text-navy-900 min-[375px]:text-2xl md:text-3xl">Featured Legislation</h2>
        <QuorumCounter />
      </div>
      <p class="mb-6 font-serif text-sm italic text-navy-600 min-[375px]:text-base">Bills of particular importance to nobody in particular</p>
      <div class="gold-rule"></div>
      <div class="mt-6 grid grid-cols-1 gap-4 min-[430px]:mt-8 min-[430px]:gap-5 min-[520px]:grid-cols-2 lg:grid-cols-3">
        {showcaseNotBills.map((bill) => (
          <BillCard bill={bill} />
        ))}
      </div>
    </section>
  )}

  <Divider withSeal={true} />

  <div class="mx-auto max-w-6xl px-3 py-6 min-[375px]:px-4 min-[430px]:py-8">
    <DidYouKnow />
  </div>

  <section class="mx-auto max-w-6xl px-3 py-8 min-[375px]:px-4 min-[430px]:py-10 md:py-12">
    <h2 class="mb-2 font-serif text-xl font-bold text-navy-900 min-[375px]:text-2xl md:text-3xl">From the Absurdity Index</h2>
    <p class="mb-6 font-serif text-sm italic text-navy-600 min-[375px]:text-base">Satirical bills that actually make sense — fresh from the floor (or possibly the floor drain)</p>
    <div class="gold-rule"></div>
    <div class="mt-6 grid grid-cols-1 gap-4 min-[430px]:mt-8 min-[430px]:gap-5 min-[520px]:grid-cols-2 lg:grid-cols-3">
      {showcaseNotBills.map((bill) => (
        <BillCard bill={bill} />
      ))}
    </div>
    <div class="mt-8 text-center min-[430px]:mt-10">
      <a
        href="/not-bills"
        class="inline-block rounded bg-navy-800 px-6 py-2.5 font-serif text-base text-gold-300 transition-colors hover:bg-navy-700 min-[430px]:px-8 min-[430px]:py-3 min-[430px]:text-lg"
      >
        View All Not Bills &rarr;
      </a>
    </div>
  </section>

  <section class="mt-10 bg-navy-900 py-12 min-[430px]:mt-12 min-[430px]:py-16">
    <div class="mx-auto max-w-2xl px-3 min-[375px]:px-4">
      <NewsletterForm />
    </div>
  </section>
</BaseLayout>
