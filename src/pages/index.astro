---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroBanner from '../components/ui/HeroBanner.astro';
import BillCard from '../components/bills/BillCard.astro';
import Divider from '../components/ui/Divider.astro';
import RunningTicker from '../components/satirical/RunningTicker.astro';
import QuorumCounter from '../components/satirical/QuorumCounter.astro';
import NewsletterForm from '../components/ui/NewsletterForm.astro';
import { getCollection } from 'astro:content';

const allBills = await getCollection('bills');

// Real bills — sorted by absurdity
const realBills = allBills
  .filter((b) => b.data.billType === 'real')
  .sort((a, b) => (b.data.absurdityIndex ?? 0) - (a.data.absurdityIndex ?? 0))
  .slice(0, 3);

// Not bills — featured first, then recent
const notBills = allBills
  .filter((b) => b.data.billType !== 'real');
const featuredNotBills = notBills
  .filter((b) => b.data.featured)
  .sort((a, b) => b.data.dateIntroduced.getTime() - a.data.dateIntroduced.getTime())
  .slice(0, 3);
const recentNotBills = notBills
  .sort((a, b) => b.data.dateIntroduced.getTime() - a.data.dateIntroduced.getTime())
  .slice(0, 3);

// Use featured if available, otherwise recent
const showcaseNotBills = featuredNotBills.length > 0 ? featuredNotBills : recentNotBills;
---

<BaseLayout title="Home" description="Where the bills make sense and the laws don't. Real federal bills scored on an Absurdity Index, paired with satirical legislation that actually makes sense.">
  <RunningTicker />
  <HeroBanner />

  {realBills.length > 0 && (
    <section class="max-w-6xl mx-auto px-4 py-12">
      <div class="flex items-center justify-between mb-2">
        <h2 class="font-serif text-2xl md:text-3xl text-navy-900 font-bold">Most Absurd Real Bills</h2>
        <QuorumCounter />
      </div>
      <p class="text-navy-600 mb-6 font-serif italic">Real legislation from Congress, ranked by absurdity</p>
      <div class="gold-rule"></div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
        {realBills.map((bill) => (
          <BillCard bill={bill} />
        ))}
      </div>
      <div class="text-center mt-10">
        <a
          href="/bills"
          class="inline-block px-8 py-3 bg-navy-800 text-gold-300 font-serif text-lg rounded hover:bg-navy-700 transition-colors"
        >
          View All Real Bills &rarr;
        </a>
      </div>
    </section>
  )}

  {realBills.length === 0 && (
    <section class="max-w-6xl mx-auto px-4 py-12">
      <div class="flex items-center justify-between mb-2">
        <h2 class="font-serif text-2xl md:text-3xl text-navy-900 font-bold">Featured Legislation</h2>
        <QuorumCounter />
      </div>
      <p class="text-navy-600 mb-6 font-serif italic">Bills of particular importance to nobody in particular</p>
      <div class="gold-rule"></div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
        {showcaseNotBills.map((bill) => (
          <BillCard bill={bill} />
        ))}
      </div>
    </section>
  )}

  <Divider withSeal={true} />

  <section class="max-w-6xl mx-auto px-4 py-12">
    <h2 class="font-serif text-2xl md:text-3xl text-navy-900 font-bold mb-2">From the Not-Congress</h2>
    <p class="text-navy-600 mb-6 font-serif italic">Satirical bills that actually make sense — fresh from the floor (or possibly the floor drain)</p>
    <div class="gold-rule"></div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
      {showcaseNotBills.map((bill) => (
        <BillCard bill={bill} />
      ))}
    </div>
    <div class="text-center mt-10">
      <a
        href="/not-bills"
        class="inline-block px-8 py-3 bg-navy-800 text-gold-300 font-serif text-lg rounded hover:bg-navy-700 transition-colors"
      >
        View All Not Bills &rarr;
      </a>
    </div>
  </section>

  <section class="bg-navy-900 py-16 mt-12">
    <div class="max-w-2xl mx-auto px-4">
      <NewsletterForm />
    </div>
  </section>
</BaseLayout>
