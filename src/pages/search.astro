---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Search"
  description="Search across all bills, not-bills, and legislation on the Absurdity Index."
  robots="noindex, follow"
>
  <link slot="head" href="/pagefind/pagefind-ui.css" rel="stylesheet" />

  <style slot="head">
    /* Override Pagefind UI styles to match site theme */
    :root {
      --pagefind-ui-scale: 1;
      --pagefind-ui-primary: #0a1628;
      --pagefind-ui-text: #0a1628;
      --pagefind-ui-background: #f5f0e8;
      --pagefind-ui-border: #c5a572;
      --pagefind-ui-tag: #c5a572;
      --pagefind-ui-border-width: 2px;
      --pagefind-ui-border-radius: 6px;
      --pagefind-ui-font: 'Inter', sans-serif;
    }

    /* Dark mode for Pagefind */
    :global(html.dark) {
      --pagefind-ui-primary: #e8b85a;
      --pagefind-ui-text: #f5f0e8;
      --pagefind-ui-background: #0f1a2e;
      --pagefind-ui-border: #c5a572;
      --pagefind-ui-tag: #c5a572;
    }
  </style>

  <div class="max-w-4xl mx-auto px-4 py-12">
    <div class="text-center mb-10">
      <p class="text-sm text-gold-600 font-mono uppercase tracking-widest mb-2">
        Congressional Search
      </p>
      <h1 class="font-serif text-3xl md:text-4xl text-navy-900 font-bold">Search the Record</h1>
      <p class="text-navy-600 font-serif italic mt-3">
        Find any bill faster than Congress finds consensus
      </p>
    </div>
    <div class="gold-rule"></div>

    <div id="search" class="mt-8"></div>
  </div>

  <script is:inline>
    window.addEventListener('DOMContentLoaded', async () => {
      const pagefindUI = await import('/pagefind/pagefind-ui.js');
      new pagefindUI.PagefindUI({
        element: '#search',
        showSubResults: true,
        showImages: false,
      });

      // Support /search/?q=... so Schema.org SearchAction results are usable.
      const q = new URLSearchParams(window.location.search).get('q');
      if (q) {
        let attempts = 0;
        const tryApply = () => {
          const input = document.querySelector('input.pagefind-ui__search-input');
          if (input) {
            input.value = q;
            input.dispatchEvent(new Event('input', { bubbles: true }));
            return;
          }
          attempts += 1;
          if (attempts < 30) requestAnimationFrame(tryApply);
        };
        tryApply();
      }
    });
  </script>
</BaseLayout>
