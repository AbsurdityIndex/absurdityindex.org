---
import BaseLayout from '../layouts/BaseLayout.astro';
import OfficialSeal from '../components/ui/OfficialSeal.astro';
import Divider from '../components/ui/Divider.astro';

// Bingo squares (excluding free space - we'll always put that in the center)
const bingoSquares = [
  "Bill acronym spells a word",
  "Unanimous vote on something meaningless",
  "15+ word bill title",
  'Someone says "the American people"',
  "Recess announced",
  "Filibuster threatened",
  "Bipartisan on naming a post office",
  "Committee hearing runs overtime",
  "Member reads from notes they clearly didn't write",
  "Reference to the Founding Fathers",
  "Appeal to children's futures",
  "Mentions the Constitution without reading it",
  "Dramatic pause before vote",
  'Uses "unprecedented" incorrectly',
  "Technical difficulties during virtual testimony",
  "Someone yields their time",
  'Invokes "common sense"',
  "Charts that prove nothing",
  "Awkward attempt at humor",
  "Member clearly on wrong camera",
  "Constituent letter that sounds suspiciously scripted",
  "Bipartisan photo op",
  "Bill renamed to be more patriotic",
  "Expert testimony ignored",
  "Deadline extended again",
  "Hearing adjourned before anything decided",
  "Member asks question unrelated to topic",
  "Reference to Reagan (any context)",
  "Vague promise of future legislation",
  "Someone thanks colleagues for their service",
  "Bill number contains symbolic digits",
  "Amendment that contradicts the bill",
  "Procedural motion to delay",
  "Member arrives late, asks question already answered",
  "Staff member does all the work",
  "Mention of 'working families'",
  "Completely empty chamber",
  "Someone speaks past their time",
  "Budget figure rounded to nearest billion",
  "Appeal to small business owners",
  "Reference to 'my good friend across the aisle'",
  "Vague threats about the deficit",
  "Roll call takes longer than debate",
  "Someone cites a study without naming it",
  "Bill passed without being read",
  "Motion to table indefinitely",
  "Member confused about which bill they're discussing",
  "Viewer falls asleep watching congressional coverage",
];
---

<BaseLayout title="Congressional Bingo" description="Play along at home! Print your bingo card and cross off squares as Congress does Congress things.">
  <main class="bg-parchment min-h-screen print:bg-white">

    <!-- Hero (hidden in print) -->
    <section class="bg-navy-900 py-12 sm:py-16 print:hidden">
      <div class="max-w-5xl mx-auto px-4 text-center">
        <OfficialSeal size="100" />
        <p class="text-sm text-gold-500 font-mono uppercase tracking-widest mt-6 mb-2">A Civic Engagement Activity</p>
        <h1 class="font-serif text-3xl sm:text-4xl lg:text-5xl text-gold-400 font-bold">
          Congressional Bingo
        </h1>
        <p class="mt-4 text-gold-300/80 font-sans text-lg max-w-2xl mx-auto">
          The only bipartisan game in Washington. Watch any congressional coverage, tune into a hearing, or just follow along on social media.
        </p>
        <p class="mt-2 text-navy-400 font-mono text-sm">
          {bingoSquares.length} possible squares | Endless entertainment value
        </p>
      </div>
    </section>

    <div class="max-w-4xl mx-auto px-4 py-10 sm:py-14 print:py-0 print:px-0 print:max-w-none">

      <!-- Print Header (only visible in print) -->
      <div class="hidden print:block text-center mb-6">
        <h1 class="font-serif text-3xl font-bold">Congressional Bingo</h1>
        <p class="text-sm text-gray-600">AbsurdityIndex.org | Play Along at Home!</p>
      </div>

      <!-- Controls (hidden in print) -->
      <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8 print:hidden">
        <button
          id="generate-btn"
          class="px-6 py-3 bg-gold-500 text-navy-900 font-serif text-lg rounded hover:bg-gold-400 transition-colors font-bold flex items-center justify-center gap-2"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
          </svg>
          Generate New Card
        </button>
        <button
          onclick="window.print()"
          class="px-6 py-3 bg-navy-700 text-cream-100 font-serif text-lg rounded hover:bg-navy-600 transition-colors font-bold flex items-center justify-center gap-2"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd"/>
          </svg>
          Print Card
        </button>
      </div>

      <!-- Bingo Card -->
      <div class="bg-white rounded-lg border-4 border-navy-800 shadow-xl overflow-hidden print:shadow-none print:rounded-none print:border-2">
        <!-- Header -->
        <div class="bg-navy-800 text-gold-400 text-center py-3 print:py-2">
          <h2 class="font-serif text-2xl sm:text-3xl font-bold tracking-wide print:text-xl">B I N G O</h2>
        </div>

        <!-- Grid -->
        <div id="bingo-grid" class="grid grid-cols-5 gap-px bg-navy-300 print:gap-0">
          <!-- Squares will be populated by JavaScript -->
          <!-- Initial server-side render with shuffled cards -->
        </div>
      </div>

      <Divider withSeal={true} />

      <!-- How to Play (hidden in print) -->
      <section class="bg-white rounded-lg border border-navy-200 p-6 sm:p-8 shadow-md print:hidden">
        <h2 class="font-serif text-2xl text-navy-900 font-bold mb-4 flex items-center gap-3">
          <span class="text-3xl">?</span>
          How to Play
        </h2>
        <div class="space-y-4 text-navy-700 font-sans">
          <div class="flex gap-4">
            <span class="shrink-0 w-8 h-8 bg-gold-500 text-navy-900 rounded-full flex items-center justify-center font-bold">1</span>
            <p><strong>Generate a card</strong> by clicking the button above. Each card is randomly generated with 24 unique squares plus the free center space.</p>
          </div>
          <div class="flex gap-4">
            <span class="shrink-0 w-8 h-8 bg-gold-500 text-navy-900 rounded-full flex items-center justify-center font-bold">2</span>
            <p><strong>Watch any congressional proceeding</strong> — live floor coverage, committee hearings, press conferences, or just follow along on social media. It all counts.</p>
          </div>
          <div class="flex gap-4">
            <span class="shrink-0 w-8 h-8 bg-gold-500 text-navy-900 rounded-full flex items-center justify-center font-bold">3</span>
            <p><strong>Mark your squares</strong> when you witness the described event. Click a square to toggle it, or print the card and use a good old-fashioned pen.</p>
          </div>
          <div class="flex gap-4">
            <span class="shrink-0 w-8 h-8 bg-gold-500 text-navy-900 rounded-full flex items-center justify-center font-bold">4</span>
            <p><strong>Get five in a row</strong> (horizontal, vertical, or diagonal) and shout "BINGO!" — or just sigh deeply, which is also an acceptable response.</p>
          </div>
        </div>

        <div class="mt-6 p-4 bg-cream-200 rounded-lg border border-gold-300">
          <p class="font-serif text-sm text-navy-700 italic text-center">
            <strong>Pro tip:</strong> The center square is always free because, well, that's pretty much guaranteed before lunch.
          </p>
        </div>
      </section>

      <!-- Fun Rules (hidden in print) -->
      <section class="mt-6 bg-navy-800 rounded-lg p-6 sm:p-8 border border-navy-700 print:hidden">
        <h2 class="font-serif text-2xl text-gold-400 font-bold mb-4">House Rules</h2>
        <ul class="space-y-3 text-gold-300/90 font-sans text-sm">
          <li class="flex gap-3">
            <span class="text-gold-500 shrink-0">&#9733;</span>
            <span><strong class="text-gold-400">Speed Round:</strong> Try to fill your card during a single committee hearing. Warning: may induce existential dread.</span>
          </li>
          <li class="flex gap-3">
            <span class="text-gold-500 shrink-0">&#9733;</span>
            <span><strong class="text-gold-400">Multiplayer Mode:</strong> Generate multiple cards and race your friends. Loser has to read the full text of the next omnibus bill.</span>
          </li>
          <li class="flex gap-3">
            <span class="text-gold-500 shrink-0">&#9733;</span>
            <span><strong class="text-gold-400">Blackout Round:</strong> Fill every square. Estimated completion time: one filibuster.</span>
          </li>
          <li class="flex gap-3">
            <span class="text-gold-500 shrink-0">&#9733;</span>
            <span><strong class="text-gold-400">Drinking Game Variant:</strong> We legally cannot recommend this, but we also can't stop you.</span>
          </li>
        </ul>
      </section>

      <!-- Disclaimer -->
      <div class="mt-6 bg-cream-200 border border-gold-300 rounded p-4 text-xs text-navy-600 leading-relaxed text-center print:hidden">
        <p>
          <strong>Satire Notice:</strong> This game is satirical entertainment. No actual members of Congress
          were consulted, though we're pretty sure they'd fill multiple cards daily if they played.
          Side effects may include increased civic awareness and decreased faith in institutions.
        </p>
      </div>

    </div>
  </main>

  <script define:vars={{ bingoSquares }}>
    // Fisher-Yates shuffle
    function shuffle(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateCard() {
      const shuffled = shuffle(bingoSquares).slice(0, 24);
      // Insert free space in the middle (position 12)
      shuffled.splice(12, 0, 'FREE');
      return shuffled;
    }

    function renderCard(squares) {
      const grid = document.getElementById('bingo-grid');
      if (!grid) return;

      grid.innerHTML = squares.map((text, i) => {
        const isFree = text === 'FREE';
        const baseClasses = 'aspect-square flex items-center justify-center p-2 text-center cursor-pointer transition-all duration-200 select-none';
        const freeClasses = isFree
          ? 'bg-gold-500 text-navy-900'
          : 'bg-cream-100 text-navy-800 hover:bg-gold-100';

        return `
          <div
            class="${baseClasses} ${freeClasses}"
            data-index="${i}"
            data-marked="${isFree ? 'true' : 'false'}"
            onclick="toggleSquare(this)"
          >
            <span class="text-xs sm:text-sm font-sans leading-tight print:text-[10px]">
              ${isFree ? '<span class="font-bold text-sm sm:text-base print:text-xs">FREE</span><br><span class="text-[10px] sm:text-xs print:text-[8px]">Congress Does Nothing</span>' : text}
            </span>
          </div>
        `;
      }).join('');
    }

    // Toggle square marking
    window.toggleSquare = function(el) {
      const isMarked = el.dataset.marked === 'true';
      const isFree = el.querySelector('span').textContent.includes('FREE');

      if (isFree) return; // Free space is always marked

      if (isMarked) {
        el.dataset.marked = 'false';
        el.classList.remove('bg-gold-400', 'text-navy-900', 'ring-2', 'ring-gold-600');
        el.classList.add('bg-cream-100', 'text-navy-800', 'hover:bg-gold-100');
      } else {
        el.dataset.marked = 'true';
        el.classList.remove('bg-cream-100', 'text-navy-800', 'hover:bg-gold-100');
        el.classList.add('bg-gold-400', 'text-navy-900', 'ring-2', 'ring-gold-600');
      }

      checkBingo();
    };

    // Check for bingo
    function checkBingo() {
      const squares = document.querySelectorAll('#bingo-grid > div');
      const marked = Array.from(squares).map(el => el.dataset.marked === 'true');

      // Winning combinations (indices)
      const lines = [
        // Rows
        [0, 1, 2, 3, 4],
        [5, 6, 7, 8, 9],
        [10, 11, 12, 13, 14],
        [15, 16, 17, 18, 19],
        [20, 21, 22, 23, 24],
        // Columns
        [0, 5, 10, 15, 20],
        [1, 6, 11, 16, 21],
        [2, 7, 12, 17, 22],
        [3, 8, 13, 18, 23],
        [4, 9, 14, 19, 24],
        // Diagonals
        [0, 6, 12, 18, 24],
        [4, 8, 12, 16, 20],
      ];

      const hasBingo = lines.some(line => line.every(i => marked[i]));

      if (hasBingo) {
        // Add subtle celebration
        const grid = document.getElementById('bingo-grid');
        if (grid && !grid.classList.contains('bingo-winner')) {
          grid.classList.add('bingo-winner');
          // Could add confetti or animation here
        }
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderCard(generateCard());

      const btn = document.getElementById('generate-btn');
      if (btn) {
        btn.addEventListener('click', () => {
          const grid = document.getElementById('bingo-grid');
          if (grid) grid.classList.remove('bingo-winner');
          renderCard(generateCard());
        });
      }
    });
  </script>

  <style>
    /* Print-specific styles for bingo card */
    @media print {
      #bingo-grid > div {
        border: 1px solid #333 !important;
        background: white !important;
        color: black !important;
        min-height: 80px;
        font-size: 9pt !important;
      }

      #bingo-grid > div[data-marked="true"] {
        background: #f0e4ca !important;
      }

      #bingo-grid {
        gap: 0 !important;
        border: 2px solid #333;
      }

      /* Ensure card fits on one page */
      .bingo-card-container {
        max-width: 7in;
        margin: 0 auto;
      }
    }

    /* Bingo winner animation */
    .bingo-winner {
      animation: winner-pulse 0.5s ease-in-out 3;
    }

    @keyframes winner-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
  </style>
</BaseLayout>
