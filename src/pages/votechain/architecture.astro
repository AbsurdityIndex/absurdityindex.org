---
import BaseLayout from '../../layouts/BaseLayout.astro';
import OfficialSeal from '../../components/ui/OfficialSeal.astro';
import Divider from '../../components/ui/Divider.astro';
import Icon from '../../components/ui/Icon.astro';
import { Content as DocContent } from '../../../docs/votechain-architecture.md';
---

<BaseLayout
  title="VoteChain Architecture"
  description="Production architecture map for VoteChain + EWP: servers, ownership boundaries, and why each component exists."
  ogType="article"
  article={{
    publishedTime: '2026-02-08',
    author: 'Absurdity Index',
    section: 'Policy',
    tags: ['votechain', 'architecture', 'ewp', 'election security', 'cryptography'],
  }}
>
  <div class="max-w-4xl mx-auto px-4 py-12">
    <div class="text-center mb-10">
      <div class="flex justify-center"><OfficialSeal size="160" /></div>
      <p class="text-sm text-gold-600 font-mono uppercase tracking-widest mt-6 mb-2">
        System Map
      </p>
      <h1 class="font-serif text-3xl md:text-4xl text-navy-900 font-bold">VoteChain Architecture</h1>
      <p class="text-navy-600 font-serif italic mt-3">
        Where the servers live, who operates them, and why the boundaries matter
      </p>

      <div class="mt-5 flex flex-wrap justify-center gap-2">
        <a
          href="/votechain"
          class="inline-flex items-center gap-2 rounded-md border border-navy-200 bg-white px-4 py-2 text-navy-800 font-sans text-sm font-semibold hover:border-gold-500 hover:shadow-sm transition-all"
        >
          <Icon name="home" class="text-navy-700" size={18} />
          VoteChain Overview
        </a>
        <a
          href="/votechain/ewp"
          class="inline-flex items-center gap-2 rounded-md border border-navy-200 bg-white px-4 py-2 text-navy-800 font-sans text-sm font-semibold hover:border-gold-500 hover:shadow-sm transition-all"
        >
          <Icon name="file-text" class="text-navy-700" size={18} />
          EWP PRD
        </a>
        <a
          href="/votechain/poc"
          class="inline-flex items-center gap-2 rounded-md bg-navy-800 px-4 py-2 text-gold-200 font-sans text-sm font-semibold hover:bg-navy-700 transition-colors"
        >
          <Icon name="vote" class="text-gold-300" size={18} />
          Open POC
        </a>
        <a
          href="/votechain/assurance"
          class="inline-flex items-center gap-2 rounded-md bg-gold-500 px-4 py-2 text-navy-900 font-sans text-sm font-semibold hover:bg-gold-400 transition-colors"
        >
          <Icon name="clipboard-list" class="text-navy-900" size={18} />
          Assurance Playbooks
        </a>
      </div>
    </div>

    <div class="gold-rule"></div>
    <Divider withSeal={true} />

    <div class="bg-parchment rounded-lg shadow-lg p-8 md:p-12">
      <div class="bill-content prd-content">
        <DocContent />
      </div>
    </div>
  </div>

  <!-- Mermaid.js for diagram rendering -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', function () {
      // Astro/Shiki renders fenced code blocks as <pre data-language="mermaid">
      var preBlocks = document.querySelectorAll('pre[data-language=\"mermaid\"]');
      if (preBlocks.length === 0) return;

      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js';
      script.onload = function () {
        var isDark = document.documentElement.classList.contains('dark');

        window.mermaid.initialize({
          startOnLoad: false,
          theme: isDark ? 'dark' : 'default',
          securityLevel: 'loose',
          flowchart: { useMaxWidth: true, htmlLabels: true },
          sequence: { useMaxWidth: true },
        });

        preBlocks.forEach(function (pre, index) {
          var container = document.createElement('div');
          container.className = 'mermaid-diagram my-6 overflow-x-auto';
          container.id = 'mermaid-diagram-' + index;
          container.textContent = pre.textContent;
          pre.parentElement.replaceChild(container, pre);
        });

        window.mermaid.run({ querySelector: '.mermaid-diagram' });
      };
      document.head.appendChild(script);
    });
  </script>
</BaseLayout>

